<!DOCTYPE html>
<html>
<head>
    <title>Virtue / Vice</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../css/list.css">
    <script src="http://www.parsecdn.com/js/parse-1.6.7.min.js"></script>
    <script type="text/javascript" src="../js/app.js"></script>
    <script type="text/javascript">
        window.onload = addHabitToList;
    </script>
</head>
<body>
    <section>
        <h1>Habit List</h1>
        <ul id="habit-list">
            <li>
                <ul class="habit-info">
                    <li><div class="habit-name">Sleep 8 hours</div></li>
                    <li><img class="habit-icon" src="../img/sleep.jpg" alt="habit icon"></li>
                </ul>
                <div class="message">
                    <span class="message-total">
                        <strong class="day-streak"></strong> days in a row! Best Record: <strong class="best-record"></strong>
                        <div class="progressBar">
                            <div class="progress"></div>
                        </div>
                    </span><br>
                    <span class="message-today">Completed <strong>1/1</strong> for today!</span>
                </div>
                <div class="habit-record">
                    <button type="button" class="record record-down" onclick="thumbsDown(this);resetProgress(this);" title="">
                        <img src="../img/thumbsDown.png" alt="Thumbs Down">
                    </button>
                    <button type="button" class="record record-up" onclick="thumbsUp(this);increaseProgress(this);" title="">
                        <img src="../img/thumbsUp.png" alt="Thumbs Up">
                    </button>
                </div>
                <div class="habit-op">
                    <button type="button" class="op op-done" onclick="showMsg(this);" title="done">
                        <img src="../img/done.svg" alt="Done">
                    </button>
                    <button type="button" class="op op-edit" onclick="location.href='edit.html'" title="edit habit">
                        <img src="../img/edit.svg" alt="Edit">
                    </button>
                    <button type="button" class="op op-del" onclick="deleteHabit(this);" title="delete habit">
                        <img src="../img/delete.svg" alt="Del">
                    </button>
                </div>
            </li>
            <li>
                <ul class="habit-info">
                    <li><div class="habit-name">Eat Healthy</div></li>
                    <li><img class="habit-icon" src="../img/salad.jpg" alt="habit icon"></li>
                </ul>
                <div class="message">
                    <span class="message-total">
                        <strong class="day-streak"></strong> days in a row! Best Record: <strong class="best-record"></strong>
                        <div class="progressBar">
                            <div class="progress"></div>
                        </div>
                    </span><br>
                    <span class="message-today">Completed <strong>1/3</strong> for today!</span>
                </div>
                <div class="habit-record">
                    <button type="button" class="record record-down" onclick="thumbsDown(this);resetProgress(this);" title="">
                        <img src="../img/thumbsDown.png" alt="Thumbs Down">
                    </button>
                    <button type="button" class="record record-up" onclick="thumbsUp(this);increaseProgress(this);" title="">
                        <img src="../img/thumbsUp.png" alt="Thumbs Up">
                    </button>
                </div>
                <div class="habit-op">
                    <button type="button" class="op op-done" onclick="showMsg(this);" title="done">
                        <img src="../img/done.svg" alt="Done">
                    </button>
                    <button type="button" class="op op-edit" onclick="location.href='edit.html'" title="edit habit">
                        <img src="../img/edit.svg" alt="Edit">
                    </button>
                    <button type="button" class="op op-del" onclick="deleteHabit(this);" title="delete habit">
                        <img src="../img/delete.svg" alt="Del">
                    </button>
                </div>
            </li>
            <li>
                <ul class="habit-info">
                    <li><div class="habit-name">Exercise 30 minutes</div></li>
                    <li><img class="habit-icon" src="../img/run.jpg" alt="habit icon"></li>
                </ul>
                <div class="message">
                    <span class="message-total">
                        <strong class="day-streak"></strong> days in a row! Best Record: <strong class="best-record"></strong>
                        <div class="progressBar">
                            <div class="progress"></div>
                        </div>
                    </span><br>
                    <span class="message-today">Completed <strong>1/2</strong> for today!</span>
                </div>
                <div class="habit-record">
                    <button type="button" class="record record-down" onclick="thumbsDown(this);resetProgress()" title="">
                        <img src="../img/thumbsDown.png" alt="Thumbs Down">
                    </button>
                    <button type="button" class="record record-up" onclick="thumbsUp(this);increaseProgress();" title="">
                        <img src="../img/thumbsUp.png" alt="Thumbs Up">
                    </button>
                </div>
                <div class="habit-op">
                    <button type="button" class="op op-done" onclick="showMsg(this);" title="done">
                        <img src="../img/done.svg" alt="Done">
                    </button>
                    <button type="button" class="op op-edit" onclick="location.href='edit.html'" title="edit habit">
                        <img src="../img/edit.svg" alt="Edit">
                    </button>
                    <button type="button" class="op op-del" onclick="deleteHabit(this);" title="delete habit">
                        <img src="../img/delete.svg" alt="Del">
                    </button>
                </div>
            </li>
        </ul>
    </section>

    <button type="button" id="addHabit" onclick="location.href='add.html'" title="add habit">+</button>

    <script type="text/javascript">
        var dayStreak = new Array();
        var bestRecord = new Array();

        var listItems = document.getElementById('habit-list').children;

        len = listItems.length;

        for( var i = 0; i < len; i++ ) {
            var habitName = listItems[i].getElementsByClassName('habit-name')[0].innerHTML;
            dayStreak[ habitName ] = 0;
            bestRecord[ habitName ] = 0;

            listItems[i].getElementsByClassName('best-record')[0].innerHTML = 0;
            listItems[i].getElementsByClassName('day-streak')[0].innerHTML = 0;
        }

        function showMsg(element){
            var msgElement = (element.parentNode.parentNode.getElementsByClassName("message"))[0];
            // alert(msgElement.innerHTML);
            msgElement.style.visibility="visible";
        }

        function deleteHabit(element) {
            if (confirm("Do you want to delete this habit?")) {
                var child = element.parentNode.parentNode;
                var parent = child.parentNode;
                parent.removeChild(child);
            } 
            else {/*do nothing*/}

        }

        function increaseProgress(element) {
            var habitName = element.parentNode.parentNode.getElementsByClassName('habit-name')[0].innerHTML;
            var progress = element.parentNode.parentNode.getElementsByClassName("progress")[0];

            var percentage = dayStreak[ habitName ] / 10 * 100;

            requestAnimationFrame(function(){
                percentage = percentage.toString() + '%';
                console.log(percentage);
                progress.style.transition = "width 1s linear";
                progress.style.width = percentage;
            });
        }

        function resetProgress(element) {
            bar = element.parentNode.parentNode.getElementsByClassName("progress")[0];

            requestAnimationFrame(function(){
                bar.style.transition = "width 1s linear";
                bar.style.width = "0px";
            });
        }

        function thumbsUp(element) {
            var habitName = element.parentNode.parentNode.getElementsByClassName('habit-name')[0].innerHTML; 

            dayStreak[ habitName ]++;

            if( dayStreak[ habitName ] > bestRecord[ habitName ] ) {
                bestRecord[ habitName ]++;
                var best = element.parentNode.parentNode.getElementsByClassName('best-record')[0];
                best.innerHTML = bestRecord[ habitName ];
            }

            var days = element.parentNode.parentNode.getElementsByClassName('day-streak')[0];
            days.innerHTML = dayStreak[ habitName ];
        }

        function thumbsDown(element) {
            var habitName = element.parentNode.parentNode.getElementsByClassName('habit-name')[0].innerHTML; 

            dayStreak[ habitName ] = 0;
            var days = element.parentNode.parentNode.getElementsByClassName('day-streak')[0];
            days.innerHTML = dayStreak[ habitName ];
        }
    </script>
</body>
</html>